<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Academic Webpage" />
    <meta name="author" content="Cai Songbai" />
    <title id="title">Woodman - Academic Homepage</title>

    <!-- Icon -->
    <link rel="icon" type="image/x-icon" href="static/assets/favicon.ico" />

    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;1,400&display=swap" rel="stylesheet" />

    <!-- Styles -->
    <link type="text/css" href="static/css/styles.css" rel="stylesheet" />
    <link type="text/css" href="static/css/main.css" rel="stylesheet" />

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <!-- Tools -->
    <script type="text/javascript" src="static/js/bootstrap.bundle.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" src="static/js/marked.min.js"></script>
    <script type="text/javascript" src="static/js/js-yaml.min.js"></script>

    <!-- MathJax -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>

<body id="page-top">
    <!-- Navigation-->
    <nav class="header navbar navbar-expand-lg navbar-light fixed-top shadow-sm" id="mainNav">
        <div class="container px-5">
            <a id="page-top-title" class="navbar-brand fw-bold" href="#page-top">Woodman</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                MENU <i class="bi-list"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto me-4 my-3 my-lg-0">
                    <li class="nav-item"><a class="nav-link me-lg-3" href="#home">HOME</a></li>
                    <li class="nav-item"><a class="nav-link me-lg-3" href="#publications">PUBLICATIONS</a></li>
                    <li class="nav-item"><a class="nav-link me-lg-3" href="#experience">EXPERIENCE</a></li>
                    <li class="nav-item"><a class="nav-link me-lg-3" href="#awards">AWARDS</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 3D Banner Section (Liquid Metal) -->
    <div id="canvas-container">
        <div class="hero-overlay">
            <!-- ID 保持不变，scripts.js 会填充文字 -->
            <h2 id="top-section-bg-text" class="display-3 lh-1 font-alt"></h2>
        </div>
    </div>

    <!-- Avatar Section (White Border) -->
    <div id="avatar-container">
        <img src="static/assets/img/photo.png" alt="Cai Songbai" class="shadow">
    </div>

    <!-- Content Sections -->
    <!-- Home -->
    <section class="bg-gradient-primary-to-secondary-light mt5 md5" id="home">
        <div class="container px-5">
            <header><h2 id="home-subtitle"></h2></header>
            <div class="main-body" id="home-md"></div>
        </div>
    </section>

    <!-- Publications -->
    <section class="bg-gradient-primary-to-secondary-gray mt5 md5" id="publications">
        <div class="container px-5">
            <header><h2 id="publications-subtitle"><i class="bi bi-file-text-fill"></i>&nbsp;PUBLICATIONS</h2></header>
            <div class="main-body" id="publications-md"></div>
        </div>
    </section>

    <!-- Experience -->
    <section class="bg-gradient-primary-to-secondary-dark mt5 md5" id="experience">
        <div class="container px-5">
            <header><h2 id="experience-subtitle"><i class="bi bi-briefcase-fill"></i> EXPERIENCE </h2></header>
            <div class="main-body" id="experience-md"></div>
        </div>
    </section>

    <!-- Awards -->
    <section class="bg-gradient-primary-to-secondary-light mt5 md5" id="awards">
        <div class="container px-5">
            <header><h2 id="awards-subtitle"><i class="bi bi-award-fill"></i>AWARDS </h2></header>
            <div class="main-body" id="awards-md"></div>
        </div>
    </section>

    <!-- Footer-->
    <footer class="bg-bottom text-center py-5">
        <div class="container px-5">
            <div class="text-white-50 small">
                <div id="copyright-text" class="mb-2"></div>
                <a id="github-link" href="https://github.com/Woodman718">Github</a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script type="text/javascript" src="static/js/scripts.js"></script>

    <!-- Three.js Logic: Liquid Metal Sphere -->
    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        const container = document.getElementById('canvas-container');

        // 1. Scene & Camera
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.002); // 深邃雾气

        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(0, 0, 8);

        const renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ReinhardToneMapping;
        container.appendChild(renderer.domElement);

        // 2. Lighting (Purple/Cyan Cyberpunk Style)
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);

        const pointLight1 = new THREE.PointLight(0x8800ff, 80, 50);
        pointLight1.position.set(-5, 3, 5);
        scene.add(pointLight1);

        const pointLight2 = new THREE.PointLight(0x00ffff, 40, 50);
        pointLight2.position.set(5, -3, 5);
        scene.add(pointLight2);

        // 3. Liquid Object (The "Blob")
        const geometry = new THREE.IcosahedronGeometry(2, 30); // High detail for smooth waves
        const material = new THREE.MeshPhysicalMaterial({
            color: 0x111111,
            metalness: 0.9,
            roughness: 0.1,
            clearcoat: 1.0,
            clearcoatRoughness: 0.1,
        });

        const mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);

        // Store original positions for wave calculation
        const originalPositions = geometry.attributes.position.array.slice();
        const count = geometry.attributes.position.count;

        // 4. Particles (Background Stars)
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 500;
        const posArray = new Float32Array(particlesCount * 3);
        for(let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 25;
        }
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.03,
            color: 0xffffff,
            transparent: true,
            opacity: 0.6,
        });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // 5. Post-Processing (Bloom)
        const composer = new EffectComposer(renderer);
        const renderPass = new RenderPass(scene, camera);
        composer.addPass(renderPass);

        const bloomPass = new UnrealBloomPass(new THREE.Vector2(container.clientWidth, container.clientHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.1;
        bloomPass.strength = 1.2;
        bloomPass.radius = 0.5;
        composer.addPass(bloomPass);

        // 6. Interaction
        let mouseX = 0;
        let mouseY = 0;
        let targetX = 0;
        let targetY = 0;

        const windowHalfX = container.clientWidth / 2;
        const windowHalfY = container.clientHeight / 2;

        document.addEventListener('mousemove', (event) => {
            // Ensure mouse interaction only happens near the banner
            if (event.clientY < container.clientHeight + 200) {
                mouseX = (event.clientX - windowHalfX) * 0.001;
                mouseY = (event.clientY - windowHalfY) * 0.001;
            }
        });

        // 7. Animation Loop
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);

            const time = clock.getElapsedTime();
            const positions = geometry.attributes.position;

            // Vertex Animation (Liquid Effect)
            for (let i = 0; i < count; i++) {
                const x = originalPositions[i * 3];
                const y = originalPositions[i * 3 + 1];
                const z = originalPositions[i * 3 + 2];

                const perlin = Math.sin(x * 2 + time * 1.5) * Math.cos(y * 1.5 + time * 1.5) * Math.sin(z * 2 + time * 1.5);
                const normalizeRatio = 1 + perlin * 0.2; // Distortion strength

                positions.setXYZ(i, x * normalizeRatio, y * normalizeRatio, z * normalizeRatio);
            }
            positions.needsUpdate = true;
            geometry.computeVertexNormals();

            // Interaction Smoothing
            targetX = mouseX * 0.5;
            targetY = mouseY * 0.5;

            mesh.rotation.y += 0.003;
            mesh.rotation.x += 0.05 * (targetY - mesh.rotation.x);
            mesh.rotation.y += 0.05 * (targetX - mesh.rotation.y);

            particlesMesh.rotation.y = -time * 0.05;

            composer.render();
        }

        animate();

        // Resize Handler
        window.addEventListener('resize', () => {
            const w = container.clientWidth;
            const h = container.clientHeight;
            camera.aspect = w / h;
            camera.updateProjectionMatrix();
            renderer.setSize(w, h);
            composer.setSize(w, h);
        });
    </script>
</body>
</html>
